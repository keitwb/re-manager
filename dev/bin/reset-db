#!/bin/bash

set -e
# Resets the Mongo database and loads development fixtures

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd $SCRIPT_DIR/../..

kubectl="kubectl --context minikube"
kubectl_run_flags="-i -t --rm --restart=Never --image quay.io/rem/mongodb-setup:dev"

TAG=dev make mongodb-setup

$kubectl exec -it mongo -- mongo rem --eval 'db.dropDatabase();'
$kubectl run db-setup $kubectl_run_flags
$kubectl run dev-fixtures $kubectl_run_flags -- /opt/dev/load-fixtures.sh
